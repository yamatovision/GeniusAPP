# プロンプト使用統計コード削除スコープ

## 概要
不要になったプロンプト使用統計に関するコードを完全に削除します。これには、バックエンドの統計収集モデル、APIエンドポイント、フロントエンドの表示コード、および拡張機能の使用記録機能が含まれます。コードの削除により、アプリケーションのサイズを縮小し、メンテナンス性を向上させます。

## 成功基準
- プロンプト使用統計に関するすべてのコードが削除される
- アプリケーションが引き続き正常に機能する
- プロンプト詳細画面から使用統計グラフと関連機能が削除される
- 関連するAPIエンドポイントが削除される
- データベースからの使用統計の記録が停止される

## 対象ファイル

### バックエンド
- `portal/backend/models/promptUsage.model.js`
  - 使用統計モデル自体を削除
- `portal/backend/controllers/prompt.controller.js`
  - 使用統計記録と取得に関するコントローラーメソッドを削除
  - 使用統計に依存するその他のメソッドを修正
- `portal/backend/routes/prompt.routes.js`
  - 使用統計関連のルートを削除
- `portal/backend/services/prompt.service.js`
  - 使用統計に関連するサービスメソッドを削除

### フロントエンド
- `portal/frontend/src/components/prompts/PromptDetail.js`
  - 使用統計表示タブとグラフを削除
  - 関連するAPIコール削除
- `portal/frontend/src/services/prompt.service.js`
  - 使用統計API呼び出しメソッドを削除
  - recordPromptUsage、getPromptUsageStats、getPromptUsageComparison等を削除
- `portal/frontend/src/utils/stats-formatter.js`
  - 統計データフォーマット関連のユーティリティ関数を削除または調整

### VSCode拡張
- `src/api/claudeCodeApiClient.ts`
  - recordPromptUsage関数と関連コードを削除
  - その他の依存関数を修正

## 実装計画

### ステップ1: コード分析とコメント追加（1日）
1. 使用統計に関連するすべてのコードをマッピング
2. 削除すべきコードにコメントで印をつける
3. 依存関係の確認と影響範囲の分析
4. 削除計画の作成

### ステップ2: バックエンドからの機能削除（1-2日）
1. データベースからプロンプト使用統計関連のモデルを削除
2. APIエンドポイントとコントローラーメソッドの削除
3. バックエンドサービスからの関連機能削除
4. 関連ルーティングの削除

### ステップ3: フロントエンドからの機能削除（1-2日）
1. PromptDetail.jsから使用統計タブとグラフの削除
2. プロンプトサービスから使用統計メソッドの削除
3. 統計フォーマッター関連コードの削除
4. その他の依存コードの調整

### ステップ4: VSCode拡張からの機能削除（1日）
1. claudeCodeApiClient.tsからrecordPromptUsage関数を削除
2. 関連するエラーハンドリングコードの調整
3. 依存している他のコードの修正

### ステップ5: テストと検証（1日）
1. 削除後のアプリケーション全体の動作テスト
2. API呼び出しが正しく調整されていることの確認
3. フロントエンドUIに問題がないことの確認
4. バックエンドログの確認

## 技術的アプローチ
1. コードを削除する前に、各コンポーネントが正しく機能していることを確認するテストを実施します
2. バックエンドからフロントエンドへの順で削除を進め、リグレッションを避けます
3. 必要に応じて関連テストコードも削除または修正します
4. 削除するコードが他の機能に与える影響を最小限に抑えるため、依存関係を慎重に分析します

## リスクと対策
- **リスク**: 必要なコードを誤って削除してしまう可能性
  - **対策**: 事前にコードマッピングを行い、チームで削除計画をレビュー
- **リスク**: 他の機能に依存する部分があり、削除後に問題が発生する可能性
  - **対策**: 依存関係の詳細な分析と、削除後の徹底したテスト
- **リスク**: データベーススキーマの変更によるリスク
  - **対策**: 開発環境で十分にテストしてから本番環境に適用

## コード削除の影響
- プロンプト詳細画面から使用統計タブが削除されることでUI/UXが変更
- フロントエンドのバンドルサイズが削減
- バックエンドのコードベースが簡素化
- データベースの負荷低減
- API呼び出し数の削減

## 注意事項
- 使用統計に関連するデータベースコレクションは、まずバックアップを取った上で削除します
- 本番環境への適用前に、ステージング環境で十分にテストします
- フロントエンドのビルドとデプロイ、バックエンドの再起動を適切に計画します