# デプロイ・公開スコープ

## 目的

このスコープは、AppGeniusプロジェクトの各コンポーネント（中央プロンプト管理Webポータル、VSCode拡張機能、ClaudeCode連携）を本番環境にデプロイし、一般公開するプロセスを完成させることを目的としています。既に実装されている機能を実際のユーザーが利用できるよう、デプロイスクリプトの作成、CI/CD設定、公開前の最終確認を行います。

## 背景

AppGeniusプロジェクトは以下のコンポーネントから構成されています：

1. **中央プロンプト管理Webポータル**:
   - Node.js/Expressバックエンド
   - Reactフロントエンド
   - MongoDB データベース

2. **VSCode拡張機能**:
   - TypeScriptで実装されたVSCode拡張

3. **ClaudeCode連携**:
   - VSCode拡張とClaudeCode CLIの連携

基本的なデプロイ手順はdocs/deploy.mdに文書化されていますが、実際のデプロイプロセスの自動化と公開準備はまだ完了していません。

## 主要なタスク

### 1. 中央プロンプト管理ポータルのデプロイ自動化

- **バックエンドデプロイスクリプト作成**
  - Railway/Renderへの自動デプロイスクリプト
  - 環境変数の安全な設定と管理
  - デプロイ前のビルドと検証プロセス
  - デプロイ後の自動テスト

- **フロントエンドデプロイ自動化**
  - Vercelへの自動デプロイ設定
  - 環境変数の適切な構成
  - プレビュー環境との統合
  - デプロイ成功の検証

- **データベース設定の自動化**
  - MongoDB Atlasクラスター作成スクリプト
  - データベースマイグレーションの自動化
  - シードデータの投入プロセス
  - バックアップと復元の自動化

### 2. VSCode拡張機能のMarketplace公開準備

- **Marketplace公開アセットの作成**
  - アイコン、バナー、スクリーンショットの準備
  - 詳細なマーケットプレイス説明文の作成
  - タグとカテゴリの最適化
  - デモGIFとビデオの作成

- **公開自動化スクリプト**
  - CIからの自動パッケージング
  - バージョン番号の自動管理
  - CHANGELOGの自動生成
  - vsce publishコマンドの自動化

- **インストール・設定ガイド**
  - 詳細なインストール手順書
  - 初期設定ウィザードの改善
  - トラブルシューティングガイド
  - FAQ作成

### 3. CI/CD 環境構築

- **GitHub Actionsワークフロー作成**
  - テスト・ビルド・デプロイの自動化
  - プルリクエスト時の自動検証
  - ブランチ保護ルールの設定
  - セキュリティスキャンの統合

- **バージョン管理の自動化**
  - セマンティックバージョニングの適用
  - リリースノートの自動生成
  - Gitタグの自動作成
  - リリースアーティファクトの管理

- **品質ゲート設定**
  - コードカバレッジの閾値設定
  - パフォーマンステストの自動化
  - セキュリティスキャンのゲート
  - 依存関係脆弱性チェック

### 4. 本番環境モニタリングと運用

- **監視ダッシュボード設定**
  - サーバーパフォーマンスメトリクス監視
  - エラーログの集中管理
  - ユーザー行動分析
  - アラート設定

- **バックアップ戦略の実装**
  - 定期的なデータベースバックアップ
  - 障害復旧計画の文書化
  - バックアップ復元テスト
  - 長期保存ポリシーの設定

- **セキュリティ対策強化**
  - ペネトレーションテストの実施
  - セキュリティヘッダーの設定
  - CORS設定の最適化
  - レート制限の実装

## 実装対象ファイル

1. **新規ファイル**
   - `/.github/workflows/backend-deploy.yml` - バックエンドデプロイワークフロー
   - `/.github/workflows/frontend-deploy.yml` - フロントエンドデプロイワークフロー
   - `/.github/workflows/vscode-publish.yml` - VSCode拡張公開ワークフロー
   - `/scripts/deploy/setup-db.js` - データベース初期化スクリプト
   - `/scripts/deploy/verify-deployment.js` - デプロイ検証スクリプト
   - `/scripts/release/generate-changelog.js` - CHANGELOGジェネレーター
   - `/scripts/release/bump-version.js` - バージョン管理スクリプト
   - `/docs/user-guide/installation.md` - インストールガイド
   - `/docs/user-guide/marketplace.md` - Marketplace掲載情報
   - `/assets/marketplace/icon.png` - マーケットプレイスアイコン
   - `/assets/marketplace/banner.png` - マーケットプレイスバナー
   - `/assets/marketplace/screenshots/` - スクリーンショット一式

2. **更新ファイル**
   - `/package.json` - スクリプトとバージョン情報の更新
   - `/README.md` - インストール手順の更新
   - `/docs/deploy.md` - デプロイドキュメントの更新
   - `/portal/backend/server.js` - モニタリング統合
   - `/portal/frontend/package.json` - デプロイスクリプト追加
   - `/CHANGELOG.md` - リリースノート形式の更新

## アクセプタンス基準

1. **デプロイ自動化**
   - 単一コマンドでバックエンドとフロントエンドが正常にデプロイされる
   - 環境変数が安全に設定される
   - デプロイが自動的に検証される
   - ロールバックメカニズムが機能する

2. **VSCode拡張公開**
   - 拡張機能がVSCode Marketplaceに正常に公開される
   - マーケットプレイスの説明とスクリーンショットが適切
   - インストールと設定が容易で明確な手順がある
   - バージョン更新プロセスが自動化されている

3. **CI/CD品質**
   - すべてのワークフローが安定して動作する
   - プルリクエストで自動テストが実行される
   - メインブランチへのマージで自動デプロイが行われる
   - 品質ゲートが機能し、問題のあるコードがデプロイされない

4. **モニタリングと運用**
   - サーバーパフォーマンスが継続的に監視される
   - エラーが適切にログに記録され、アラートが送信される
   - バックアップが定期的に実行され、復元が検証される
   - セキュリティ対策が本番環境に適用される

## ユーザーストーリー

1. **VSCode拡張利用者として、**
   - Marketplaceから簡単に拡張機能を見つけてインストールできる
   - 明確なインストール手順と初期設定ガイドを参照できる
   - 問題が発生した場合にトラブルシューティングガイドを利用できる
   - 新バージョンが利用可能になった時に自動的に通知を受け取る

2. **WebポータルのIT管理者として、**
   - 中央プロンプト管理システムを簡単にデプロイできる
   - パフォーマンスと可用性を監視できる
   - セキュリティアップデートを迅速に適用できる
   - バックアップと復元プロセスを実行できる

3. **開発チームメンバーとして、**
   - 変更をプッシュするだけで自動的にテストとデプロイが行われる
   - デプロイの成功/失敗通知を受け取る
   - デプロイステータスをダッシュボードで確認できる
   - 問題が発生した場合にロールバックを実行できる

## 実装の注意点

1. **セキュリティ**
   - シークレットやAPIキーはGitHubシークレットとして安全に保存
   - 本番環境のデプロイには審査プロセスを適用
   - セキュリティスキャンを定期的に実行
   - 権限の最小化を徹底

2. **信頼性**
   - デプロイ前の自動テストを徹底
   - カナリアデプロイの実施（可能な場合）
   - ロールバックプランの準備
   - 障害復旧プロセスの文書化と訓練

3. **ユーザー体験**
   - 明確なインストール手順
   - 視覚的に魅力的なマーケットプレイスのプレゼンス
   - デモとスクリーンショットの質の高さ
   - わかりやすいエラーメッセージとサポート情報

4. **メンテナンス性**
   - デプロイスクリプトの文書化
   - バージョニングポリシーの明確化
   - メンテナンス作業の自動化
   - 監視と通知の適切な設定

## 見積もり

- 工数: 5人日
- 優先度: 高（他のスコープが実装完了した後）