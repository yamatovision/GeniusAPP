# リファクタリング計画: 不要タブ削除とLPレプリカ専用化 2025-06-20

## 1. 現状分析

### 1.1 対象概要
AppGeniusからLP作成専用ソフトウェアへの転換に伴い、現在のタブベースUIから不要な機能を削除し、LPレプリカ機能のみを残すリファクタリングを実施する。プロジェクト選択機能と開発プロンプト機能は維持し、メインエリアをLPレプリカ専用に変更する。

### 1.2 問題点と課題
- 複数のタブが存在し、LP作成に不要な機能が多数含まれている
- デフォルトタブが`scope-progress`（進捗状況）に設定されており、LP作成と無関係
- タブ切り替えロジックが複雑で、単一機能には過剰な実装
- 状態管理で不要なタブ関連データを保持している
- 削除対象タブに関連するサービスやAPIが残存している

### 1.3 関連ファイル一覧
- **UI テンプレート**: `src/ui/scopeManager/templates/ScopeManagerTemplate.ts`
- **タブマネージャー**: `media/components/tabManager/tabManager.js`
- **状態管理**: `media/core/stateManager.js`
- **メッセージハンドラ**: `src/ui/scopeManager/ScopeManagerPanel.ts`
- **サービス層**: 各削除対象タブの専用サービス
- **CSS**: `media/scopeManager.css`
- **マークダウンファイル**: `docs/SCOPE_PROGRESS.md`, `docs/requirements.md`等

### 1.4 削除対象タブと現在の状況
1. **進捗状況タブ** (`scope-progress`) - デフォルトタブとして広範囲に使用
2. **ファイルタブ** (`files`) - ファイルブラウザ機能
3. **ClaudeCode連携タブ** (`claude-code`) - 外部連携機能
4. **モックアップギャラリータブ** (`tools`) - モックアップ表示機能
5. **要件定義タブ** (`requirements`) - 現在コメントアウト中だが処理は残存

## 2. リファクタリングの目標

### 2.1 期待される成果
- LP作成に特化したシンプルなUI構成の実現
- 不要なコード削除によるメンテナンス性向上
- アプリケーション起動時間の短縮
- メモリ使用量の削減
- ユーザビリティの向上（迷いのないUI）

### 2.2 維持すべき機能
- プロジェクト選択機能
- 開発プロンプト機能
- LPレプリカ機能（メインエリアとして）
- プロジェクト切り替え時の状態保存
- ファイル監視とリアルタイム更新

## 3. 理想的な実装

### 3.1 全体アーキテクチャ
```
┌─────────────────────────────────────────┐
│ プロジェクト選択エリア                    │
├─────────────────────────────────────────┤
│ 開発プロンプトエリア                      │
├─────────────────────────────────────────┤
│ LPレプリカエリア（メイン）                │
│ - タブバーなし                           │
│ - 直接コンテンツ表示                      │
│ - LPレプリカ機能のみ                      │
└─────────────────────────────────────────┘
```

### 3.2 核心的な改善ポイント
- タブベースUIからシングルコンテンツUIへの変更
- デフォルト動作をLPレプリカに変更
- 不要なタブ切り替えロジックの完全削除
- 状態管理の簡素化

### 3.3 新しいディレクトリ構造
既存構造を維持し、削除対象ファイルのみ除去。LPレプリカ関連ファイルは変更なし。

## 4. 実装計画

### フェーズ1: デフォルト動作変更（安全性確保）
- **目標**: システムの基本動作をLPレプリカに変更し、削除前の安全性を確保
- **影響範囲**: タブマネージャー、状態管理
- **タスク**:
  1. **T1.1**: デフォルトタブをlp-replicaに変更
     - 対象: `media/components/tabManager/tabManager.js:18`
     - 実装: `const savedTab = state.activeTab || 'lp-replica';`
  2. **T1.2**: 状態管理のデフォルト値変更
     - 対象: `media/core/stateManager.js:41`
     - 実装: デフォルトactiveTabを'lp-replica'に変更
  3. **T1.3**: プロジェクト初期化時のタブ設定変更
     - 対象: `src/ui/scopeManager/ScopeManagerPanel.ts`
     - 実装: 新規プロジェクト作成時のデフォルトタブ設定
- **検証ポイント**:
  - 新規プロジェクト作成時にLPレプリカタブが選択される
  - 既存プロジェクト切り替え時にLPレプリカタブに自動切り替わる
  - LPレプリカ機能が正常に動作する

### フェーズ2: UIテンプレート修正（タブバー削除）
- **目標**: タブバーを非表示にし、LPレプリカコンテンツを直接表示
- **影響範囲**: HTMLテンプレート生成
- **タスク**:
  1. **T2.1**: タブボタンの削除
     - 対象: `src/ui/scopeManager/templates/ScopeManagerTemplate.ts:201-207`
     - 実装: タブボタンのHTML生成部分をコメントアウトまたは削除
  2. **T2.2**: 削除対象タブのコンテンツ生成メソッド削除
     - 対象: 同ファイル内の各`_generate*TabContent`メソッド
     - 実装: 進捗状況、ファイル、ClaudeCode、ツール、要件定義関連メソッドの削除
  3. **T2.3**: LPレプリカコンテンツの直接表示
     - 対象: HTMLテンプレート構造
     - 実装: 条件分岐を削除し、LPレプリカコンテンツを常時表示
- **検証ポイント**:
  - タブバーが表示されない
  - LPレプリカコンテンツが直接表示される
  - レイアウトが崩れていない

### フェーズ3: タブマネージャーロジック削除
- **目標**: 不要なタブ切り替えロジックとイベントハンドラの削除
- **影響範囲**: タブマネージャー全体
- **タスク**:
  1. **T3.1**: 削除対象タブのイベント処理削除
     - 対象: `media/components/tabManager/tabManager.js:76-154`
     - 実装: scope-progress, files, claude-code, tools, requirements関連処理の削除
  2. **T3.2**: タブ切り替えメソッドの簡素化
     - 対象: 同ファイル内のselectTabメソッド
     - 実装: LPレプリカのみを対象とした単純化
  3. **T3.3**: 不要なイベントリスナーの削除
     - 対象: タブクリックイベント関連
     - 実装: タブが1つのみなので切り替えロジック自体が不要
- **検証ポイント**:
  - JavaScript エラーが発生しない
  - LPレプリカの動作に影響がない
  - 不要なDOM操作が実行されない

### フェーズ4: メッセージハンドラとサービス削除
- **目標**: 削除対象タブ関連のメッセージ処理とサービスクラスの削除
- **影響範囲**: バックエンド処理、サービス層
- **タスク**:
  1. **T4.1**: ScopeManagerPanelの不要case文削除
     - 対象: `src/ui/scopeManager/ScopeManagerPanel.ts`
     - 実装: 削除対象タブ関連のメッセージハンドラ削除
  2. **T4.2**: TabStateServiceの不要メソッド削除
     - 対象: `src/ui/scopeManager/services/TabStateService.ts`
     - 実装: 進捗、要件定義ファイル関連メソッドの削除
  3. **T4.3**: MessageDispatchServiceの不要処理削除
     - 対象: `src/ui/scopeManager/services/implementations/MessageDispatchServiceImpl.ts`
     - 実装: 削除対象タブ関連メッセージ処理の削除
  4. **T4.4**: FileWatcherServiceの不要監視削除
     - 対象: `src/ui/scopeManager/services/implementations/FileWatcherServiceImpl.ts`
     - 実装: SCOPE_PROGRESS.md、requirements.md監視の削除
- **検証ポイント**:
  - 不要なファイル監視が停止している
  - メッセージ処理でエラーが発生しない
  - LPレプリカ機能の通信が正常に動作する

### フェーズ5: 状態管理の最適化
- **目標**: 不要な状態データの削除と状態管理の簡素化
- **影響範囲**: クライアントサイド状態管理
- **タスク**:
  1. **T5.1**: stateManagerの不要プロパティ削除
     - 対象: `media/core/stateManager.js`
     - 実装: scopeProgressContent, requirementsContent等の削除
  2. **T5.2**: 状態初期化処理の簡素化
     - 対象: 同ファイル内の初期化メソッド
     - 実装: LPレプリカ関連のみの状態管理に変更
  3. **T5.3**: 状態保存処理の最適化
     - 対象: プロジェクト切り替え時の状態保存
     - 実装: 不要な状態データの保存処理削除
- **検証ポイント**:
  - プロジェクト切り替えが正常に動作する
  - 状態の復元が正常に行われる
  - メモリ使用量が削減されている

### フェーズ6: CSS最適化とクリーンアップ
- **目標**: 不要なスタイル定義の削除とCSS最適化
- **影響範囲**: スタイルシート
- **タスク**:
  1. **T6.1**: 削除対象タブ専用CSSの削除
     - 対象: `media/scopeManager.css`
     - 実装: scope-progress, files-tab, file-browser等のスタイル削除
  2. **T6.2**: タブバー関連スタイルの削除
     - 対象: 同ファイル内のタブ切り替えスタイル
     - 実装: tab, tab.active等のスタイル削除または簡素化
  3. **T6.3**: レイアウト調整
     - 対象: メインエリアのレイアウト
     - 実装: タブバー削除に伴うスペース調整
- **検証ポイント**:
  - 視覚的なレイアウトが適切である
  - 不要なCSSが読み込まれていない
  - レスポンシブデザインが正常に動作する

### フェーズ7: ファイル削除とドキュメント整理
- **目標**: 関連ファイルの削除と不要なドキュメントの削除
- **影響範囲**: プロジェクト全体のファイル構成
- **タスク**:
  1. **T7.1**: マークダウンファイルの削除
     - 対象: `docs/SCOPE_PROGRESS.md`, `docs/requirements.md`
     - 実装: ファイル削除（バックアップ推奨）
  2. **T7.2**: テンプレートファイルの削除
     - 対象: `docs/templates/SCOPE_PROGRESS_TEMPLATE.md`
     - 実装: ファイル削除
  3. **T7.3**: 削除対象タブ専用サービスファイルの削除
     - 対象: 各削除対象タブの専用サービスクラス
     - 実装: ファイル削除（影響確認後）
  4. **T7.4**: 不要なコマンドファイルの削除
     - 対象: `src/commands/`内の削除対象機能関連コマンド
     - 実装: ファイル削除
- **検証ポイント**:
  - アプリケーションが正常に起動する
  - すべての機能が期待通りに動作する
  - 削除されたファイルへの参照エラーがない

## 5. 期待される効果

### 5.1 コード削減
- 推定削除行数: 約2000-3000行
- 削除対象ファイル数: 約15-20ファイル
- JavaScript/TypeScript: 約1500行削減
- HTML/CSS: 約500行削減
- マークダウン/ドキュメント: 約1000行削減

### 5.2 保守性向上
- タブ切り替えロジックの複雑性排除
- 状態管理の簡素化
- 不要な依存関係の削除
- エラーの発生源となる処理の削除

### 5.3 パフォーマンス改善
- アプリケーション起動時間: 10-15%短縮予想
- メモリ使用量: 20-30%削減予想
- 不要なファイル監視処理の削除によるCPU使用量削減

## 6. リスクと対策

### 6.1 潜在的リスク
1. **既存プロジェクトの互換性問題**: 保存済みタブ状態が無効になる可能性
2. **LPレプリカ機能への意図しない影響**: 削除処理でLPレプリカが破綻する可能性
3. **段階的削除中の不整合**: フェーズ間での一時的な動作不良
4. **外部依存関係の見落とし**: 削除対象機能を参照している未発見のコード

### 6.2 対策
1. **互換性対策**: フォールバック処理でlp-replicaタブに自動切り替え
2. **影響最小化**: 各フェーズ後の動作確認を徹底
3. **ロールバック準備**: 各フェーズ完了時点でのGitコミット作成
4. **テスト強化**: LPレプリカ機能の動作テストを各段階で実施

## 7. 備考

### 7.1 実装順序の重要性
フェーズ1（デフォルト動作変更）を最初に実施することで、削除処理中もアプリケーションが正常動作を維持できる。

### 7.2 バックアップ推奨
削除対象ファイルは完全削除前にバックアップを作成し、必要に応じて復元できるようにする。

### 7.3 将来の拡張性
現在はLPレプリカのみを残すが、将来的に他の機能を追加する場合の拡張性を考慮した設計を維持する。