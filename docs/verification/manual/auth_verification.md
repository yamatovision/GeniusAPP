# 認証フロー手動検証ガイド

このガイドは、AppGeniusの認証フローを手動で検証するための手順を提供します。

## 準備

1. **VSCode環境の準備**
   - VSCodeを起動し、AppGenius拡張機能がインストールされていることを確認してください
   - 必要に応じて、拡張機能を再読み込みしてください（Command+Shift+P > Developer: Reload Window）

2. **ポータルサーバー起動（開発環境のみ）**
   - ターミナルでポータルディレクトリに移動: `cd portal`
   - サーバーを起動: `npm run dev`

## 検証項目1: 初回ログイン

**手順:**
1. VSCodeでAppGenius拡張機能のアイコンをクリックしてください（サイドバーのAppGeniusアイコン）
2. ダッシュボードが表示され、ログイン画面が表示されることを確認してください
3. テストアカウントでログインしてください

**期待結果:**
- ログイン成功後、ダッシュボードにプロジェクト一覧が表示されること
- ステータスバーに認証状態が表示されること

## 検証項目2: トークン永続化

**手順:**
1. ログイン後、VSCodeを完全に終了してください
2. VSCodeを再起動し、AppGenius拡張機能のアイコンをクリックしてください
3. ダッシュボードを開いてください

**期待結果:**
- 自動的に前回のセッションが復元され、再ログインを求められないこと
- ダッシュボードに直接アクセスできること

## 検証項目3: 分離認証モード

**手順:**
1. ターミナルでClaudeCode CLIをインストールしていない場合は、インストールしてください
2. VSCode内でAppGenius拡張機能の設定を開いてください（Command+, または Ctrl+,）
3. `AppGenius: Isolated Auth Mode`の設定を確認してください
4. 設定を有効にしてVSCodeをリロードしてください
5. AppGenius拡張機能を開き、ログインしてください

**期待結果:**
- AppGenius拡張機能で正常にログインできること
- ステータスバーに「分離認証モード」が表示されること
- この状態でターミナルからClaudeCode CLIを実行すると、別途認証を求められること

## 検証項目4: トークンの同期

**手順:**
1. 分離認証モードを無効に戻してVSCodeをリロードしてください
2. AppGenius拡張機能にログインしてください
3. ターミナルを開き、ClaudeCode CLIを実行してください: `claude --version`

**期待結果:**
- ClaudeCode CLIが認証を求めずに正常に動作すること
- ステータスバーに「ClaudeCode CLI連携済み」などのメッセージが表示されること

## 検証項目5: ログアウト処理

**手順:**
1. ステータスバーの認証アイコンを右クリックしてログアウトを選択してください
2. 再度AppGeniusダッシュボードを開いてください

**期待結果:**
- ログアウト処理が正常に完了し、ログイン画面が表示されること
- ログアウト後、保存されていた認証情報が適切に削除されること

## 検証項目6: エラー時の振る舞い

**手順:**
1. ポータルサーバーを停止してください（開発環境の場合）
2. AppGeniusダッシュボードを開き、ログインを試みてください

**期待結果:**
- 適切なエラーメッセージが表示されること
- ユーザーにリトライやトラブルシューティングのオプションが提示されること

## 検証結果の記録

検証結果を以下の形式で記録してください：

| 検証項目 | 結果 | コメント |
|---------|------|---------|
| 初回ログイン | ✅ 成功 | ログイン後ダッシュボードが正常に表示される |
| トークン永続化 | ✅ 成功 | VSCode再起動後も認証状態が維持される |
| 分離認証モード | ✅ 成功 | 分離モードが正常に機能し、CLIとの連携が適切に分離される |
| トークンの同期 | ✅ 成功 | 通常モードでCLIと認証情報が同期される |
| ログアウト処理 | ✅ 成功 | ログアウト後、認証情報が適切に削除される |
| エラー時の振る舞い | ⚠️ 一部問題あり | サーバー接続エラー時のメッセージがやや不明確 |

## 注意事項

- テスト用アカウントを使用してください
- 実際の顧客データや本番環境では検証しないでください
- 検証中に問題が発生した場合は、詳細なエラーメッセージとスクリーンショットを記録してください