# 認証フロー手動検証手順

## 1. 検証の目的

このドキュメントでは、AppGeniusの認証フローの手動検証手順を提供します。この検証の目的は以下の通りです：

- 認証プロセスの一貫性と信頼性を確認する
- ユーザーアカウント管理機能の正確性を検証する
- セッション管理とトークン処理の正確性を検証する
- 認証に関連するエラーハンドリングを検証する

## 2. 前提条件

- VSCodeがインストールされていること
- AppGenius拡張機能がインストールされていること
- テスト用のメールアドレスとパスワードが用意されていること
- インターネット接続が利用可能であること

## 3. 検証環境

- OS: Windows 10/11, macOS, Linux
- VSCode: 最新版
- AppGenius拡張機能: 最新版
- ブラウザ: Chrome, Firefox, Safari, Edge

## 4. 検証項目

### 4.1 新規登録プロセス

| ID | 検証項目 | 期待結果 | 実際の結果 | 合否 |
|----|---------|---------|-----------|------|
| R-01 | 有効なメールアドレスと強力なパスワードで新規登録 | アカウントが正常に作成され、ダッシュボードにリダイレクトされる | | |
| R-02 | 既存のメールアドレスで新規登録 | 「既に登録されているメールアドレス」というエラーメッセージが表示される | | |
| R-03 | 無効なメールアドレス形式で新規登録 | 「有効なメールアドレスを入力してください」というエラーメッセージが表示される | | |
| R-04 | 弱いパスワード（短すぎる）で新規登録 | 「パスワードは最低8文字必要です」というエラーメッセージが表示される | | |
| R-05 | 確認パスワードが一致しない場合の新規登録 | 「パスワードが一致しません」というエラーメッセージが表示される | | |

### 4.2 ログインプロセス

| ID | 検証項目 | 期待結果 | 実際の結果 | 合否 |
|----|---------|---------|-----------|------|
| L-01 | 有効な認証情報でログイン | 正常にログインでき、ダッシュボードにリダイレクトされる | | |
| L-02 | 無効なメールアドレスでログイン | 「メールアドレスまたはパスワードが無効です」というエラーメッセージが表示される | | |
| L-03 | 無効なパスワードでログイン | 「メールアドレスまたはパスワードが無効です」というエラーメッセージが表示される | | |
| L-04 | 空のフィールドでログイン | 「メールアドレスとパスワードを入力してください」というエラーメッセージが表示される | | |
| L-05 | ログイン後のブラウザリロード | ログイン状態が維持される | | |

### 4.3 ログアウトプロセス

| ID | 検証項目 | 期待結果 | 実際の結果 | 合否 |
|----|---------|---------|-----------|------|
| O-01 | ログアウトボタンクリック | 正常にログアウトされ、ログイン画面にリダイレクトされる | | |
| O-02 | ログアウト後のバックボタン | ログイン画面が表示され、前のページにアクセスできない | | |
| O-03 | ログアウト後の保護されたエンドポイントへのアクセス | ログイン画面にリダイレクトされる | | |

### 4.4 パスワード回復プロセス

| ID | 検証項目 | 期待結果 | 実際の結果 | 合否 |
|----|---------|---------|-----------|------|
| P-01 | 登録済みメールアドレスでパスワードリセット | パスワードリセットメールが送信される確認メッセージが表示される | | |
| P-02 | 未登録のメールアドレスでパスワードリセット | 「パスワードリセットメールが送信されました」というメッセージが表示される（セキュリティのため、エラーを示さない） | | |
| P-03 | パスワードリセットリンクのクリック | パスワード変更フォームが表示される | | |
| P-04 | 新しいパスワード設定 | パスワードが更新され、ログイン画面にリダイレクトされる | | |
| P-05 | 有効期限切れのリセットリンク | 「リンクの有効期限が切れています」というエラーメッセージが表示される | | |

### 4.5 セッション管理

| ID | 検証項目 | 期待結果 | 実際の結果 | 合否 |
|----|---------|---------|-----------|------|
| S-01 | VSCodeを再起動した後の認証状態 | ログイン状態が維持される | | |
| S-02 | 長時間の非アクティブ状態後のセッション | セッションが維持されるか、適切に再認証が促される | | |
| S-03 | 複数のVSCodeウィンドウでの認証状態 | すべてのウィンドウで認証状態が同期される | | |

### 4.6 エラーハンドリング

| ID | 検証項目 | 期待結果 | 実際の結果 | 合否 |
|----|---------|---------|-----------|------|
| E-01 | ネットワーク接続なしでのログイン試行 | 適切なエラーメッセージが表示される | | |
| E-02 | サーバーダウン時のログイン試行 | 適切なエラーメッセージが表示される | | |
| E-03 | APIレート制限到達時の動作 | 適切なエラーメッセージが表示され、再試行オプションが提供される | | |

### 4.7 アクセス制御

| ID | 検証項目 | 期待結果 | 実際の結果 | 合否 |
|----|---------|---------|-----------|------|
| A-01 | 一般ユーザーとして管理者機能へのアクセス | アクセスが拒否される | | |
| A-02 | 管理者としての管理者機能へのアクセス | アクセスが許可される | | |
| A-03 | 異なる組織のリソースへのアクセス | アクセスが拒否される | | |

### 4.8 分離認証モード

| ID | 検証項目 | 期待結果 | 実際の結果 | 合否 |
|----|---------|---------|-----------|------|
| C-01 | 分離認証モードの有効化 | 設定が保存され、分離モードが有効になる | | |
| C-02 | 分離モードでのClaude Code CLIとの連携 | 正常に連携でき、両方のシステムで認証が機能する | | |
| C-03 | 分離モードでのトークン消費記録 | 使用統計が正確に記録される | | |
| C-04 | 分離モードから通常モードへの切り替え | 設定が保存され、通常モードが有効になる | | |

## 5. 検証手順

### 5.1 新規登録プロセスの検証

1. VSCodeを起動し、AppGenius拡張機能を開く
2. 登録ページに移動する
3. テスト用メールアドレスとパスワードを入力する
4. 「登録」ボタンをクリックする
5. 結果を確認し、テーブルに記録する
6. 各テストケース（R-01〜R-05）について繰り返す

### 5.2 ログインプロセスの検証

1. VSCodeを起動し、AppGenius拡張機能を開く
2. ログインページに移動する
3. テストケースに応じた認証情報を入力する
4. 「ログイン」ボタンをクリックする
5. 結果を確認し、テーブルに記録する
6. 各テストケース（L-01〜L-05）について繰り返す

### 5.3 ログアウトプロセスの検証

1. 正常にログインする
2. ログアウトボタンをクリックする
3. 結果を確認し、テーブルに記録する
4. 各テストケース（O-01〜O-03）について繰り返す

### 5.4 パスワード回復プロセスの検証

1. ログインページからパスワード回復リンクをクリックする
2. テストケースに応じたメールアドレスを入力する
3. 「送信」ボタンをクリックする
4. 結果を確認し、テーブルに記録する
5. 各テストケース（P-01〜P-05）について繰り返す

### 5.5 セッション管理の検証

1. 正常にログインする
2. テストケースに応じたアクションを実行する（例：VSCode再起動）
3. 認証状態を確認する
4. 結果を確認し、テーブルに記録する
5. 各テストケース（S-01〜S-03）について繰り返す

### 5.6 エラーハンドリングの検証

1. テストケースに応じた状況を設定する（例：ネットワーク接続を切断）
2. ログイン試行を行う
3. エラーメッセージを確認する
4. 結果を確認し、テーブルに記録する
5. 各テストケース（E-01〜E-03）について繰り返す

### 5.7 アクセス制御の検証

1. 適切な権限を持つアカウントでログインする
2. テストケースに応じたリソースにアクセスを試みる
3. 結果を確認し、テーブルに記録する
4. 各テストケース（A-01〜A-03）について繰り返す

### 5.8 分離認証モードの検証

1. 設定から分離認証モードを有効/無効にする
2. Claude Code CLIとの連携をテストする
3. 使用統計の記録を確認する
4. 結果を確認し、テーブルに記録する
5. 各テストケース（C-01〜C-04）について繰り返す

## 6. 検証結果のレポート方法

検証が完了したら、以下の情報を含むレポートを作成してください：

1. 各テストケースの結果（合格/不合格）
2. 発見された問題の詳細
3. 問題の再現手順
4. スクリーンショットまたはビデオキャプチャ（該当する場合）
5. 環境情報（OS、VSCodeバージョン、拡張機能バージョンなど）

## 7. 注意事項

- テスト中に作成したテストアカウントは、テスト完了後に削除することをお勧めします
- 実際のプロダクションデータに影響を与えないように、テスト環境で検証を行ってください
- セキュリティ上の問題が発見された場合は、即座に開発チームに報告してください

## 8. 検証完了基準

以下の条件が満たされた場合、認証フローの検証は完了とみなされます：

- すべての必須テストケースが実行され、結果が記録されている
- 重大な問題が発見されていない、または修正されている
- 検証レポートが作成され、提出されている

## 9. 追加リソース

- [開発者向けAPI仕様書](../api.md)
- [認証モジュール仕様書](../auth_architecture.md)
- [セキュリティガイドライン](../security-guidelines.md)