<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>AI LP Builder - LP作成・編集</title>
  
  <!-- React, ReactDOM -->
  <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
  <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
  
  <!-- Material UI -->
  <script src="https://unpkg.com/@mui/material@5.14.5/umd/material-ui.production.min.js"></script>
  <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,400,500,700&display=swap" />
  <link rel="stylesheet" href="https://fonts.googleapis.com/icon?family=Material+Icons" />
  
  <!-- Emotion (for MUI) -->
  <script src="https://unpkg.com/@emotion/react@11.11.1/dist/emotion-react.umd.min.js"></script>
  <script src="https://unpkg.com/@emotion/styled@11.11.0/dist/emotion-styled.umd.min.js"></script>
  
  <!-- Babel -->
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
  
  <style>
    body {
      margin: 0;
      font-family: 'Roboto', 'Helvetica', 'Arial', sans-serif;
      background-color: #f5f7fa;
    }
    
    .fade-in {
      animation: fadeIn 0.3s ease-in-out;
    }
    
    @keyframes fadeIn {
      from { opacity: 0; }
      to { opacity: 1; }
    }
    
    .slide-in {
      animation: slideIn 0.3s ease-out;
    }
    
    @keyframes slideIn {
      from { transform: translateY(20px); opacity: 0; }
      to { transform: translateY(0); opacity: 1; }
    }
    
    .typing-indicator {
      display: inline-flex;
      align-items: center;
    }
    
    .typing-indicator span {
      width: 6px;
      height: 6px;
      margin: 0 1px;
      background-color: #718096;
      border-radius: 50%;
      display: inline-block;
      animation: typing 1.4s infinite both;
    }
    
    .typing-indicator span:nth-child(2) {
      animation-delay: 0.2s;
    }
    
    .typing-indicator span:nth-child(3) {
      animation-delay: 0.4s;
    }
    
    @keyframes typing {
      0% { transform: scale(1); opacity: 0.7; }
      50% { transform: scale(1.2); opacity: 1; }
      100% { transform: scale(1); opacity: 0.7; }
    }
    
    .preview-iframe {
      border: none;
      width: 100%;
      height: 100%;
      border-radius: 8px;
      box-shadow: 0px 4px 12px rgba(0, 0, 0, 0.1);
      background-color: white;
    }
    
    .custom-scrollbar {
      scrollbar-width: thin;
      scrollbar-color: #CBD5E0 #EDF2F7;
    }
    
    .custom-scrollbar::-webkit-scrollbar {
      width: 6px;
      height: 6px;
    }
    
    .custom-scrollbar::-webkit-scrollbar-track {
      background: #EDF2F7;
    }
    
    .custom-scrollbar::-webkit-scrollbar-thumb {
      background-color: #CBD5E0;
      border-radius: 6px;
    }
    
    .glow-effect {
      box-shadow: 0 0 8px rgba(66, 153, 225, 0.6);
    }
  </style>
</head>
<body>
  <div id="root"></div>

  <!-- エラーハンドリング用の初期スクリプト -->
  <script>
    window.addEventListener('error', function(event) {
      console.error('Caught global error:', event.error);
      
      // ListItemAvatar特有のエラーをキャッチ
      if (event.error && event.error.message && event.error.message.includes('ListItemAvatar is not defined')) {
        console.log('ListItemAvatarを定義します...');
        // グローバルスコープに定義
        window.ListItemAvatar = function ListItemAvatar(props) {
          return React.createElement('div', {
            className: 'MuiListItemAvatar-root',
            style: { display: 'flex', marginRight: '16px' }
          }, props.children);
        };
      }
    });
  </script>

  <script type="text/babel">
    // Material UIコンポーネントのセーフティネット
    const MaterialUIComponents = (window.MaterialUI || {});
    const React = window.React;
    const ReactDOM = window.ReactDOM;
    
    // 重要なコンポーネントが見つからない場合はエラー表示
    if (!React || !ReactDOM || !MaterialUIComponents) {
      document.getElementById('root').innerHTML = `
        <div style="padding: 20px; color: red; font-family: sans-serif;">
          <h2>必要なライブラリが読み込めませんでした</h2>
          <p>React, ReactDOM, または Material UIが見つかりません。</p>
          <p>ネットワーク接続を確認して再読み込みしてください。</p>
          <button onclick="location.reload()">再読み込み</button>
        </div>
      `;
      throw new Error('必要なライブラリが読み込めませんでした');
    }
    
    // Material UIコンポーネントを安全に取得
    const { 
      createTheme, ThemeProvider, CssBaseline, 
      AppBar, Toolbar, Typography, Button, IconButton, 
      Container, Grid, Paper, Box, Chip, Avatar,
      TextField, InputAdornment, CircularProgress,
      Tabs, Tab, List, ListItem, ListItemText, ListItemIcon,
      Divider, Switch, FormControlLabel, Select, MenuItem,
      Stepper, Step, StepLabel, StepContent, Card, CardContent,
      Dialog, DialogTitle, DialogContent, DialogActions, Alert, Collapse,
      Accordion, AccordionSummary, AccordionDetails, Tooltip, Badge
    } = MaterialUIComponents;

    // 欠けているコンポーネントがあれば定義する
    const ListItemAvatar = MaterialUIComponents.ListItemAvatar || function ListItemAvatar(props) {
      console.log('ListItemAvatarのカスタム実装を使用');
      return React.createElement('div', {
        className: 'MuiListItemAvatar-root',
        style: { display: 'flex', marginRight: '16px' }
      }, props.children);
    };
    
    // グローバルにも定義
    window.ListItemAvatar = ListItemAvatar;
    
    // テーマの作成
    const theme = createTheme({
      palette: {
        primary: {
          main: '#4299e1',
        },
        secondary: {
          main: '#9f7aea',
        },
        background: {
          default: '#f5f7fa',
          paper: '#ffffff',
        },
      },
      typography: {
        fontFamily: "'Roboto', 'Helvetica', 'Arial', sans-serif",
        h4: {
          fontWeight: 600,
        },
        h5: {
          fontWeight: 600,
        },
        h6: {
          fontWeight: 600,
        },
      },
      shape: {
        borderRadius: 10,
      },
      components: {
        MuiButton: {
          styleOverrides: {
            root: {
              textTransform: 'none',
              borderRadius: 8,
              boxShadow: 'none',
              '&:hover': {
                boxShadow: '0px 4px 8px rgba(0, 0, 0, 0.1)',
              },
            },
            containedPrimary: {
              '&:hover': {
                backgroundColor: '#3182ce',
              },
            },
          },
        },
        MuiPaper: {
          styleOverrides: {
            rounded: {
              borderRadius: 12,
            },
            elevation1: {
              boxShadow: '0px 4px 12px rgba(0, 0, 0, 0.05)',
            }
          },
        },
        MuiChip: {
          styleOverrides: {
            root: {
              borderRadius: 6,
              fontWeight: 500,
            },
          },
        },
      },
    });

    // ErrorBoundary コンポーネント
    class ErrorBoundary extends React.Component {
      constructor(props) {
        super(props);
        this.state = { hasError: false, error: null, errorInfo: null };
      }
      
      static getDerivedStateFromError(error) {
        return { hasError: true, error };
      }
      
      componentDidCatch(error, errorInfo) {
        console.error("エラーをキャッチしました:", error, errorInfo);
        this.setState({ errorInfo });
        
        // 特定のエラーに対する処理
        if (error.message && error.message.includes('ListItemAvatar is not defined')) {
          console.log('ListItemAvatarエラーを検知しました');
          // グローバルスコープに定義を追加
          if (!window.ListItemAvatar) {
            window.ListItemAvatar = function(props) {
              return React.createElement('div', {
                className: 'MuiListItemAvatar-root',
                style: { marginRight: '16px' }
              }, props.children);
            };
          }
        }
      }
      
      render() {
        if (this.state.hasError) {
          return (
            <Box 
              sx={{ 
                p: 4, 
                display: 'flex', 
                flexDirection: 'column', 
                alignItems: 'center', 
                justifyContent: 'center',
                minHeight: '200px',
                textAlign: 'center'
              }}
            >
              <Typography variant="h6" color="error" gutterBottom>
                エラーが発生しました
              </Typography>
              <Typography variant="body2" color="textSecondary" sx={{ mb: 2 }}>
                {this.state.error && this.state.error.toString()}
              </Typography>
              <Button
                variant="outlined"
                color="primary"
                onClick={() => window.location.reload()}
              >
                ページを再読み込み
              </Button>
            </Box>
          );
        }
        
        return this.props.children;
      }
    }
    
    // モックデータ - チャット履歴
    const mockChatHistory = [
      { 
        id: 1, 
        role: 'system', 
        content: 'LP作成アシスタントへようこそ。どのようなランディングページを作成したいですか？' 
      },
      { 
        id: 2, 
        role: 'user', 
        content: 'オンラインコーチング用のLPを作りたいです。ビジネスマネジメントを教えるコーチングプログラムで、ターゲットは30代〜40代の会社員や管理職です。' 
      },
      { 
        id: 3, 
        role: 'system', 
        content: 'ビジネスマネジメントのコーチングプログラム向けLPですね。以下の情報も教えていただけると、より最適なLPを作成できます：\n\n1. コーチングプログラムの期間と料金はどのくらいですか？\n2. どのような悩みや課題を解決するプログラムですか？\n3. コーチング提供者の実績や背景は？\n4. 他のコーチングと差別化できるポイントがあれば教えてください。' 
      },
      { 
        id: 4, 
        role: 'user', 
        content: '1. 3ヶ月間のプログラムで、料金は一括29.8万円、または月々9.8万円の分割払いが可能です。\n2. リーダーシップスキルの向上、チームマネジメント、タイムマネジメント、効率的な意思決定などの課題を解決します。\n3. 元大手企業の人事責任者で、15年以上のマネジメント経験があります。これまで200人以上のマネージャーを育成してきました。\n4. 実践的な内容で、すぐに職場で使えるフレームワークとツールを提供します。毎週のグループコーチングと月2回の個別コーチングがセットになっています。' 
      },
      { 
        id: 5, 
        role: 'system', 
        content: 'ありがとうございます。これらの情報を元に、効果的なLPを構成していきます。以下のようなLPの構造を提案します：\n\n1. **ヒーローセクション**：ターゲットの悩みと解決策を強調\n2. **課題認識セクション**：マネジメントで直面する具体的な課題\n3. **解決策セクション**：コーチングプログラムの概要\n4. **ベネフィットセクション**：得られる成果と変化\n5. **プログラム構成セクション**：3ヶ月の流れと内容\n6. **講師プロフィールセクション**：経験と実績\n7. **料金・申込セクション**：料金プランと申込方法\n8. **FAQ**：よくある質問と回答\n\nこの構成でよろしいですか？あるいは追加したいセクションはありますか？' 
      },
      { 
        id: 6, 
        role: 'user', 
        content: 'その構成で良いと思います。あと、受講者の声（testimonial）のセクションも追加したいです。実際に5名ほど卒業生のインタビューがあります。' 
      },
      { 
        id: 7, 
        role: 'system', 
        content: '受講者の声セクションを追加します。それでは、各セクションについて具体的なコンテンツ案を作成していきます。\n\nまず、ページ全体のデザインテイストについて確認させてください：\n\n1. カラースキームの好み（例：ブルー系、モダンなトーン、明るい色調など）\n2. 雰囲気（プロフェッショナル寄り、親しみやすさ重視など）\n3. 参考にしたいウェブサイトやデザインがあれば教えてください' 
      }
    ];
    
    // モックデータ - フレームワーク分析結果
    const mockFrameworkAnalysis = {
      framework: 'AIDA',
      stages: [
        {
          name: 'Attention（注目）',
          description: 'ターゲットの関心を引く見出しと視覚的要素',
          components: ['ヒーローセクション', '課題認識セクション'],
          goals: ['ターゲットの痛点に共感を示す', '注目を集める魅力的な見出し']
        },
        {
          name: 'Interest（興味）',
          description: 'プログラムの価値と解決できる問題の詳細説明',
          components: ['解決策セクション', 'ベネフィットセクション'],
          goals: ['具体的な成果物を示す', 'ユニークな価値提案を強調']
        },
        {
          name: 'Desire（欲求）',
          description: '受講によって得られる具体的なメリットと変化',
          components: ['プログラム構成セクション', '受講者の声セクション', '講師プロフィールセクション'],
          goals: ['信頼性の構築', '受講後のビジョンを明確に示す']
        },
        {
          name: 'Action（行動）',
          description: '申し込みへの明確な導線と障壁の排除',
          components: ['料金・申込セクション', 'FAQ'],
          goals: ['明確なCTAの設置', '申込みプロセスの簡素化', '不安要素の解消']
        }
      ]
    };
    
    // モックデータ - コンポーネント構造
    const mockComponentStructure = [
      {
        id: 'hero',
        name: 'ヒーローセクション',
        status: 'completed',
        variants: ['A', 'B'],
        active: 'A'
      },
      {
        id: 'problems',
        name: '課題認識セクション',
        status: 'completed',
        variants: ['A', 'B'],
        active: 'A'
      },
      {
        id: 'solution',
        name: '解決策セクション',
        status: 'in_progress',
        variants: ['A'],
        active: 'A'
      },
      {
        id: 'benefits',
        name: 'ベネフィットセクション',
        status: 'pending',
        variants: [],
        active: null
      },
      {
        id: 'program',
        name: 'プログラム構成セクション',
        status: 'pending',
        variants: [],
        active: null
      },
      {
        id: 'testimonials',
        name: '受講者の声セクション',
        status: 'pending',
        variants: [],
        active: null
      },
      {
        id: 'profile',
        name: '講師プロフィールセクション',
        status: 'pending',
        variants: [],
        active: null
      },
      {
        id: 'pricing',
        name: '料金・申込セクション',
        status: 'pending',
        variants: [],
        active: null
      },
      {
        id: 'faq',
        name: 'FAQセクション',
        status: 'pending',
        variants: [],
        active: null
      }
    ];
    
    // モックデータ - プロンプトテンプレート
    const mockPromptTemplates = [
      { id: 1, name: 'セクションの作成', template: '[セクション名]について、以下の要素を含めて作成してください：\n1. 見出し\n2. サブ見出し\n3. 主要コンテンツ\n4. デザイン要素' },
      { id: 2, name: 'バリアント生成', template: '既存の[セクション名]に対して、以下の点を変更したバリアントを作成してください：\n1. 見出しのトーン（より直接的/より感情的）\n2. コンテンツ構成（簡潔/詳細）\n3. ビジュアル要素の提案' },
      { id: 3, name: 'デザイン調整', template: '[セクション名]のデザインについて、以下の調整を行ってください：\n1. カラースキーム\n2. レイアウト（1カラム/2カラム等）\n3. フォントサイズと種類\n4. 余白と間隔' },
      { id: 4, name: 'コピー改善', template: '[セクション名]のコピーを以下の点から改善してください：\n1. ターゲットユーザーの課題に共感する表現\n2. 具体的なベネフィットの強調\n3. 説得力のある表現へのブラッシュアップ\n4. CTAの訴求力向上' }
    ];
    
    // モックデータ - LPプレビューHTML
    const mockPreviewHTML = `
      <!DOCTYPE html>
      <html>
      <head>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <title>ビジネスマネジメントコーチング</title>
        <style>
          body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            margin: 0;
            padding: 0;
            color: #333;
            line-height: 1.6;
          }
          .hero {
            background-color: #2a4365;
            color: white;
            padding: 60px 20px;
            text-align: center;
          }
          .hero h1 {
            font-size: 2.5rem;
            margin-bottom: 20px;
          }
          .hero p {
            font-size: 1.2rem;
            max-width: 700px;
            margin: 0 auto 30px;
          }
          .cta-button {
            display: inline-block;
            background-color: #48bb78;
            color: white;
            padding: 12px 24px;
            border-radius: 5px;
            text-decoration: none;
            font-weight: bold;
            font-size: 1.1rem;
            transition: background-color 0.3s;
          }
          .cta-button:hover {
            background-color: #38a169;
          }
          .problems {
            padding: 60px 20px;
            background-color: #f7fafc;
          }
          .container {
            max-width: 1100px;
            margin: 0 auto;
          }
          .problems h2 {
            text-align: center;
            font-size: 2rem;
            margin-bottom: 40px;
            color: #2a4365;
          }
          .problem-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 30px;
          }
          .problem-item {
            background: white;
            padding: 25px;
            border-radius: 8px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
          }
          .problem-item h3 {
            color: #2b6cb0;
            margin-top: 0;
          }
          .solution {
            padding: 60px 20px;
          }
          .solution h2 {
            text-align: center;
            font-size: 2rem;
            margin-bottom: 40px;
            color: #2a4365;
          }
          .solution-content {
            display: flex;
            align-items: center;
            flex-wrap: wrap;
          }
          .solution-text {
            flex: 1 1 500px;
            padding: 20px;
          }
          .solution-image {
            flex: 1 1 400px;
            padding: 20px;
          }
          .solution-image img {
            max-width: 100%;
            border-radius: 8px;
          }
        </style>
      </head>
      <body>
        <section class="hero">
          <div class="container">
            <h1>マネジメントスキルを磨き、真のリーダーへ</h1>
            <p>15年以上の経験を持つ元人事責任者が教える3ヶ月間の実践的コーチングプログラム。効率的なチームマネジメント、的確な意思決定、時間管理まで、すぐに実践できるスキルを習得。</p>
            <a href="#pricing" class="cta-button">詳細を見る</a>
          </div>
        </section>
        
        <section class="problems">
          <div class="container">
            <h2>こんな課題を抱えていませんか？</h2>
            <div class="problem-grid">
              <div class="problem-item">
                <h3>チームのモチベーション維持が難しい</h3>
                <p>メンバーの成長や貢献を促す方法がわからず、チーム全体のパフォーマンスが低下している。</p>
              </div>
              <div class="problem-item">
                <h3>意思決定に自信が持てない</h3>
                <p>重要な決断を迫られた時に迷いが生じ、機会損失や後悔につながっている。</p>
              </div>
              <div class="problem-item">
                <h3>時間管理がうまくいかない</h3>
                <p>日々の業務に追われ、戦略的な業務や自己成長のための時間が確保できていない。</p>
              </div>
            </div>
          </div>
        </section>
        
        <section class="solution">
          <div class="container">
            <h2>実践的なフレームワークで現場のマネジメント課題を解決</h2>
            <div class="solution-content">
              <div class="solution-text">
                <p>当コーチングプログラムでは、現場ですぐに活用できる実践的なマネジメントツールとフレームワークを提供します。講義形式ではなく、あなたの実際の課題に取り組みながらスキルを身につけていくため、学びをそのまま業務に活かせます。</p>
                <p>グループコーチングでは他の参加者との相互学習の機会があり、個別コーチングではあなた固有の課題に深く取り組みます。3ヶ月間で確実にマネジメントスキルを向上させ、自信を持ってチームを率いるリーダーへと成長できます。</p>
              </div>
              <div class="solution-image">
                <img src="https://images.unsplash.com/photo-1516321318423-f06f85e504b3?ixlib=rb-1.2.1&auto=format&fit=crop&w=800&q=80" alt="コーチングセッションの様子">
              </div>
            </div>
          </div>
        </section>
      </body>
      </html>
    `;
    
    // モックデータ - LPプレビューHTML（バリアントB）
    const mockPreviewHTMLVariantB = `
      <!DOCTYPE html>
      <html>
      <head>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <title>ビジネスマネジメントコーチング</title>
        <style>
          body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            margin: 0;
            padding: 0;
            color: #333;
            line-height: 1.6;
          }
          .hero {
            background: linear-gradient(135deg, #1a365d 0%, #2a4365 100%);
            color: white;
            padding: 80px 20px;
            text-align: center;
          }
          .hero h1 {
            font-size: 2.7rem;
            margin-bottom: 25px;
            font-weight: 700;
          }
          .hero p {
            font-size: 1.25rem;
            max-width: 700px;
            margin: 0 auto 35px;
            line-height: 1.7;
          }
          .cta-button {
            display: inline-block;
            background-color: #ed8936;
            color: white;
            padding: 14px 28px;
            border-radius: 30px;
            text-decoration: none;
            font-weight: bold;
            font-size: 1.15rem;
            transition: all 0.3s;
            box-shadow: 0 4px 12px rgba(237, 137, 54, 0.4);
          }
          .cta-button:hover {
            background-color: #dd6b20;
            transform: translateY(-2px);
            box-shadow: 0 6px 16px rgba(237, 137, 54, 0.5);
          }
          .problems {
            padding: 70px 20px;
            background-color: #f7fafc;
          }
          .container {
            max-width: 1100px;
            margin: 0 auto;
          }
          .problems h2 {
            text-align: center;
            font-size: 2.2rem;
            margin-bottom: 50px;
            color: #1a365d;
          }
          .problem-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 30px;
          }
          .problem-item {
            background: white;
            padding: 30px;
            border-radius: 12px;
            box-shadow: 0 10px 15px -3px rgba(0,0,0,0.1), 0 4px 6px -2px rgba(0,0,0,0.05);
            transition: all 0.3s ease;
          }
          .problem-item:hover {
            transform: translateY(-5px);
            box-shadow: 0 20px 25px -5px rgba(0,0,0,0.1), 0 10px 10px -5px rgba(0,0,0,0.04);
          }
          .problem-item h3 {
            color: #2b6cb0;
            margin-top: 0;
            font-size: 1.3rem;
          }
          .solution {
            padding: 70px 20px;
          }
          .solution h2 {
            text-align: center;
            font-size: 2.2rem;
            margin-bottom: 50px;
            color: #1a365d;
          }
          .solution-content {
            display: flex;
            align-items: center;
            flex-wrap: wrap;
          }
          .solution-text {
            flex: 1 1 500px;
            padding: 30px;
          }
          .solution-image {
            flex: 1 1 400px;
            padding: 20px;
          }
          .solution-image img {
            max-width: 100%;
            border-radius: 12px;
            box-shadow: 0 20px 25px -5px rgba(0,0,0,0.1), 0 10px 10px -5px rgba(0,0,0,0.04);
          }
        </style>
      </head>
      <body>
        <section class="hero">
          <div class="container">
            <h1>マネジメントの壁を突破し、<br>キャリアを加速させる</h1>
            <p>現場で15年以上の実績を持つ元人事責任者があなたの成長を徹底サポート。3ヶ月間で200人以上が実証した効果的なリーダーシップ開発プログラム。</p>
            <a href="#pricing" class="cta-button">無料カウンセリングに申し込む</a>
          </div>
        </section>
        
        <section class="problems">
          <div class="container">
            <h2>成長するマネージャーの課題とは？</h2>
            <div class="problem-grid">
              <div class="problem-item">
                <h3>チームの潜在能力を引き出せない</h3>
                <p>メンバー一人ひとりの強みを活かし、チーム全体のパフォーマンスを最大化する方法が分からず、成果にムラが生じている。</p>
              </div>
              <div class="problem-item">
                <h3>プレッシャーの中での意思決定</h3>
                <p>不確実性の高い状況で、迅速かつ的確な決断を下すことに不安を感じ、リーダーとしての自信が揺らいでいる。</p>
              </div>
              <div class="problem-item">
                <h3>業務と自己成長のバランス</h3>
                <p>日々の業務対応に追われ、戦略的思考や自己成長のための時間を確保できず、キャリアの停滞を感じている。</p>
              </div>
            </div>
          </div>
        </section>
        
        <section class="solution">
          <div class="container">
            <h2>明日から使える実践的リーダーシップ育成プログラム</h2>
            <div class="solution-content">
              <div class="solution-text">
                <p>「知識」だけでなく「実践力」を重視した当プログラムでは、あなたの実際の職場環境に合わせたカスタマイズされたフレームワークを提供。週次のグループセッションではケーススタディを通じた相互学習で視野を広げ、月2回の個別コーチングではあなた固有の課題に深くコミットします。</p>
                <p>参加者の93%が「具体的な業務改善につながった」と回答し、76%が「6ヶ月以内に昇進・昇格を実現」しています。リーダーとしての自信を獲得し、キャリアを加速させる確かな一歩を踏み出しませんか？</p>
              </div>
              <div class="solution-image">
                <img src="https://images.unsplash.com/photo-1552664730-d307ca884978?ixlib=rb-1.2.1&auto=format&fit=crop&w=800&q=80" alt="リーダーシップトレーニングの様子">
              </div>
            </div>
          </div>
        </section>
      </body>
      </html>
    `;
    
    // チャットメッセージコンポーネント
    const ChatMessage = ({ message }) => {
      const isSystem = message.role === 'system';
      
      return (
        <Box 
          sx={{ 
            display: 'flex',
            mb: 2,
            flexDirection: isSystem ? 'row' : 'row-reverse'
          }}
          className="fade-in"
        >
          <Avatar 
            sx={{ 
              bgcolor: isSystem ? 'primary.main' : 'secondary.main',
              width: 36,
              height: 36,
              mr: isSystem ? 1.5 : 0,
              ml: isSystem ? 0 : 1.5
            }}
          >
            {isSystem ? 'AI' : 'You'}
          </Avatar>
          <Paper 
            sx={{ 
              p: 2, 
              maxWidth: '75%',
              borderRadius: '12px',
              borderTopLeftRadius: isSystem ? 0 : '12px',
              borderTopRightRadius: isSystem ? '12px' : 0,
              backgroundColor: isSystem ? 'white' : '#f0f4f8'
            }}
            elevation={1}
          >
            <Typography variant="body1" sx={{ whiteSpace: 'pre-line' }}>
              {message.content}
            </Typography>
          </Paper>
        </Box>
      );
    };
    
    // タイピングインジケーター
    const TypingIndicator = () => (
      <Box 
        sx={{ 
          display: 'flex',
          mb: 2,
        }}
      >
        <Avatar 
          sx={{ 
            bgcolor: 'primary.main',
            width: 36,
            height: 36,
            mr: 1.5
          }}
        >
          AI
        </Avatar>
        <Paper 
          sx={{ 
            p: 2, 
            maxWidth: '75%',
            borderRadius: '12px',
            borderTopLeftRadius: 0,
          }}
          elevation={1}
        >
          <Box className="typing-indicator">
            <span></span>
            <span></span>
            <span></span>
          </Box>
        </Paper>
      </Box>
    );
    
    // プレビューコンポーネント
    const PreviewComponent = ({ html, title, variant }) => {
      return (
        <Box sx={{ height: '100%', display: 'flex', flexDirection: 'column' }}>
          <Box sx={{ p: 1, backgroundColor: '#f0f4f8', borderTopLeftRadius: 8, borderTopRightRadius: 8, display: 'flex', alignItems: 'center' }}>
            <Box sx={{ display: 'flex', gap: 0.5, mr: 2 }}>
              <Box sx={{ width: 10, height: 10, borderRadius: '50%', backgroundColor: '#fc8181' }}></Box>
              <Box sx={{ width: 10, height: 10, borderRadius: '50%', backgroundColor: '#f6e05e' }}></Box>
              <Box sx={{ width: 10, height: 10, borderRadius: '50%', backgroundColor: '#68d391' }}></Box>
            </Box>
            <Typography variant="caption" sx={{ flexGrow: 1, textAlign: 'center', fontWeight: 'medium' }}>
              {title} - バリアント{variant}
            </Typography>
          </Box>
          <Box sx={{ flexGrow: 1, position: 'relative', backgroundColor: 'white' }}>
            <iframe
              className="preview-iframe"
              title={`Preview ${title} Variant ${variant}`}
              srcDoc={html}
            />
          </Box>
        </Box>
      );
    };
    
    // コンポーネントツリーアイテム
    const ComponentTreeItem = ({ component, onSelect, activeComponent }) => {
      const isActive = activeComponent === component.id;
      
      const getStatusIcon = (status) => {
        switch(status) {
          case 'completed':
            return <span className="material-icons" style={{ color: '#48bb78', fontSize: 18 }}>check_circle</span>;
          case 'in_progress':
            return <span className="material-icons" style={{ color: '#4299e1', fontSize: 18 }}>autorenew</span>;
          case 'pending':
            return <span className="material-icons" style={{ color: '#a0aec0', fontSize: 18 }}>pending</span>;
          default:
            return null;
        }
      };
      
      return (
        <ListItem 
          button 
          sx={{ 
            borderRadius: 2, 
            backgroundColor: isActive ? 'rgba(66, 153, 225, 0.08)' : 'transparent',
            border: isActive ? '1px solid rgba(66, 153, 225, 0.5)' : '1px solid transparent',
            mb: 1,
            transition: 'all 0.2s'
          }}
          onClick={() => onSelect(component.id)}
          className={isActive ? 'glow-effect' : ''}
        >
          <ListItemIcon sx={{ minWidth: 40 }}>
            {getStatusIcon(component.status)}
          </ListItemIcon>
          <ListItemText 
            primary={component.name} 
            primaryTypographyProps={{ 
              fontWeight: isActive ? 'medium' : 'regular',
              color: component.status === 'pending' ? 'text.secondary' : 'text.primary'
            }}
          />
          {component.variants.length > 0 && (
            <Chip 
              size="small" 
              label={`${component.variants.length} バリアント`} 
              sx={{ 
                backgroundColor: '#e2e8f0',
                fontWeight: 'medium',
                fontSize: '0.7rem'
              }}
            />
          )}
        </ListItem>
      );
    };
    
    // フレームワークステージカード
    const FrameworkStageCard = ({ stage, isActive }) => {
      return (
        <Card 
          sx={{ 
            mb: 2,
            boxShadow: isActive ? '0 0 0 2px #4299e1' : 'none',
            transition: 'all 0.2s',
            backgroundColor: isActive ? 'rgba(66, 153, 225, 0.08)' : 'white'
          }}
        >
          <CardContent>
            <Typography variant="h6" gutterBottom>{stage.name}</Typography>
            <Typography variant="body2" color="textSecondary" gutterBottom>{stage.description}</Typography>
            
            <Typography variant="subtitle2" sx={{ mt: 2, mb: 1 }}>対象コンポーネント:</Typography>
            <Box sx={{ display: 'flex', flexWrap: 'wrap', gap: 0.5, mb: 1.5 }}>
              {stage.components.map((component, idx) => (
                <Chip 
                  key={idx} 
                  label={component} 
                  size="small" 
                  sx={{ 
                    fontSize: '0.7rem',
                    backgroundColor: isActive ? 'rgba(66, 153, 225, 0.2)' : '#f0f4f8'
                  }}
                />
              ))}
            </Box>
            
            <Typography variant="subtitle2" sx={{ mb: 1 }}>目標:</Typography>
            <List dense disablePadding>
              {stage.goals.map((goal, idx) => (
                <ListItem key={idx} sx={{ px: 0, py: 0.25 }}>
                  <ListItemIcon sx={{ minWidth: 24 }}>
                    <span className="material-icons" style={{ fontSize: 16, color: '#4299e1' }}>
                      arrow_right
                    </span>
                  </ListItemIcon>
                  <ListItemText 
                    primary={goal} 
                    primaryTypographyProps={{ 
                      variant: 'body2',
                      fontSize: '0.8rem'
                    }}
                  />
                </ListItem>
              ))}
            </List>
          </CardContent>
        </Card>
      );
    };

    // テスト分析用の実装（必要なコンポーネント）
    const TestAnalysisScreen = () => {
      return (
        <Box sx={{ p: 3 }}>
          <Typography variant="h5" gutterBottom>テスト分析</Typography>
          <List>
            {[1, 2, 3].map((item) => (
              <ListItem key={item}>
                <Box sx={{ display: 'flex', alignItems: 'center', mr: 2 }}>
                  <Avatar sx={{ width: 40, height: 40 }}>
                    {item}
                  </Avatar>
                </Box>
                <ListItemText 
                  primary={`テスト項目 ${item}`} 
                  secondary={`これはテスト項目 ${item} の説明です`} 
                />
              </ListItem>
            ))}
          </List>
        </Box>
      );
    };
    
    // LP作成・編集画面
    const LPEditor = () => {
      const [loading, setLoading] = React.useState(false);
      const [isTyping, setIsTyping] = React.useState(false);
      const [chatMessages, setChatMessages] = React.useState(mockChatHistory);
      const [inputMessage, setInputMessage] = React.useState('');
      const [selectedComponent, setSelectedComponent] = React.useState('hero');
      const [activeVariant, setActiveVariant] = React.useState('A');
      const [previewMode, setPreviewMode] = React.useState('desktop');
      const [templateDialogOpen, setTemplateDialogOpen] = React.useState(false);
      const [selectedTemplate, setSelectedTemplate] = React.useState(null);
      
      const chatContainerRef = React.useRef(null);
      
      // チャット送信
      const handleSendMessage = () => {
        if (!inputMessage.trim()) return;
        
        // ユーザーメッセージをチャット履歴に追加
        const userMessage = {
          id: Date.now(),
          role: 'user',
          content: inputMessage
        };
        
        setChatMessages([...chatMessages, userMessage]);
        setInputMessage('');
        setIsTyping(true);
        
        // AI応答をシミュレート
        setTimeout(() => {
          const aiResponse = {
            id: Date.now() + 1,
            role: 'system',
            content: 'ご指示に基づいて処理しています。セクションの構成と内容を調整して、最適なデザインを作成します。追加の詳細や好みがあれば、教えてください。'
          };
          
          setChatMessages(prevMessages => [...prevMessages, aiResponse]);
          setIsTyping(false);
        }, 2000);
      };
      
      // チャットコンテナを自動スクロール
      React.useEffect(() => {
        if (chatContainerRef.current) {
          chatContainerRef.current.scrollTop = chatContainerRef.current.scrollHeight;
        }
      }, [chatMessages, isTyping]);
      
      // プロンプトテンプレート選択
      const handleTemplateSelect = (template) => {
        setInputMessage(template.template);
        setTemplateDialogOpen(false);
      };
      
      return (
        <ThemeProvider theme={theme}>
          <CssBaseline />
          
          {/* ヘッダー */}
          <AppBar position="static" color="default" elevation={0} sx={{ backgroundColor: 'white', borderBottom: '1px solid #e2e8f0' }}>
            <Toolbar>
              <IconButton edge="start" color="inherit" aria-label="back" sx={{ mr: 1 }}>
                <span className="material-icons">arrow_back</span>
              </IconButton>
              <Typography variant="h6" component="div" sx={{ flexGrow: 1 }}>
                ビジネスマネジメントコーチングLP
              </Typography>
              <Button 
                variant="outlined" 
                color="primary" 
                startIcon={<span className="material-icons">preview</span>}
                sx={{ mr: 1 }}
              >
                プレビュー
              </Button>
              <Button 
                variant="contained" 
                color="primary" 
                startIcon={<span className="material-icons">save</span>}
              >
                保存する
              </Button>
            </Toolbar>
          </AppBar>
          
          {/* メインコンテンツ */}
          <Box sx={{ display: 'flex', height: 'calc(100vh - 64px)' }}>
            {/* 左サイドバー - コンポーネント構造 */}
            <Paper 
              sx={{ 
                width: 300, 
                p: 2, 
                overflowY: 'auto',
                borderRight: '1px solid #e2e8f0',
                display: { xs: 'none', md: 'block' }
              }}
              className="custom-scrollbar"
              elevation={0}
            >
              <Typography variant="h6" gutterBottom>構成コンポーネント</Typography>
              <List disablePadding>
                {mockComponentStructure.map((component) => (
                  <ComponentTreeItem 
                    key={component.id} 
                    component={component} 
                    onSelect={setSelectedComponent}
                    activeComponent={selectedComponent}
                  />
                ))}
              </List>
              
              <Divider sx={{ my: 3 }} />
              
              <Typography variant="h6" gutterBottom>フレームワーク分析</Typography>
              <Typography variant="subtitle2" color="primary" sx={{ mb: 2 }}>
                {mockFrameworkAnalysis.framework} フレームワーク
              </Typography>
              
              {mockFrameworkAnalysis.stages.map((stage, idx) => (
                <FrameworkStageCard 
                  key={idx} 
                  stage={stage} 
                  isActive={stage.components.includes(
                    mockComponentStructure.find(c => c.id === selectedComponent)?.name
                  )}
                />
              ))}
            </Paper>
            
            {/* 中央 - AIチャットセクション */}
            <Box 
              sx={{ 
                flex: 1, 
                display: 'flex', 
                flexDirection: 'column',
                borderRight: '1px solid #e2e8f0'
              }}
            >
              <Box
                ref={chatContainerRef}
                sx={{ 
                  flex: 1, 
                  p: 2, 
                  overflowY: 'auto', 
                  backgroundColor: '#f8fafc' 
                }}
                className="custom-scrollbar"
              >
                {chatMessages.map((message) => (
                  <ChatMessage key={message.id} message={message} />
                ))}
                {isTyping && <TypingIndicator />}
              </Box>
              
              <Box 
                sx={{ 
                  p: 2, 
                  backgroundColor: 'white',
                  borderTop: '1px solid #e2e8f0'
                }}
              >
                <Box sx={{ display: 'flex', mb: 1.5 }}>
                  <Button 
                    size="small" 
                    variant="outlined" 
                    startIcon={<span className="material-icons">article</span>}
                    sx={{ mr: 1 }}
                    onClick={() => setTemplateDialogOpen(true)}
                  >
                    テンプレート
                  </Button>
                  <Button 
                    size="small" 
                    variant="outlined" 
                    startIcon={<span className="material-icons">upload_file</span>}
                  >
                    画像アップロード
                  </Button>
                  <Box sx={{ flex: 1 }} />
                  <Button 
                    size="small" 
                    color="primary"
                    startIcon={<span className="material-icons">history</span>}
                  >
                    履歴
                  </Button>
                </Box>
                
                <Box sx={{ display: 'flex' }}>
                  <TextField
                    fullWidth
                    variant="outlined"
                    placeholder="AIに指示を送信..."
                    multiline
                    rows={2}
                    value={inputMessage}
                    onChange={(e) => setInputMessage(e.target.value)}
                    onKeyDown={(e) => {
                      if (e.key === 'Enter' && !e.shiftKey) {
                        e.preventDefault();
                        handleSendMessage();
                      }
                    }}
                    InputProps={{
                      sx: { 
                        borderRadius: 2, 
                        backgroundColor: '#f8fafc',
                        '&.Mui-focused': {
                          boxShadow: '0 0 0 3px rgba(66, 153, 225, 0.2)',
                        }
                      }
                    }}
                  />
                  <IconButton 
                    color="primary" 
                    sx={{ ml: 1, alignSelf: 'flex-end' }}
                    onClick={handleSendMessage}
                    disabled={!inputMessage.trim()}
                  >
                    <span className="material-icons">send</span>
                  </IconButton>
                </Box>
              </Box>
            </Box>
            
            {/* 右サイドバー - プレビュー */}
            <Box 
              sx={{ 
                width: 400, 
                display: 'flex', 
                flexDirection: 'column',
                bgcolor: '#f0f4f8' 
              }}
            >
              <Box sx={{ 
                p: 2, 
                backgroundColor: 'white', 
                borderBottom: '1px solid #e2e8f0',
                display: 'flex',
                justifyContent: 'space-between',
                alignItems: 'center'
              }}>
                <Typography variant="subtitle1" fontWeight="medium">プレビュー</Typography>
                <Box>
                  <Tabs 
                    value={activeVariant} 
                    onChange={(e, val) => setActiveVariant(val)}
                    sx={{ 
                      minHeight: 36,
                      '.MuiTab-root': { minHeight: 36, py: 0.5 }
                    }}
                  >
                    <Tab label="バリアントA" value="A" />
                    <Tab label="バリアントB" value="B" />
                  </Tabs>
                </Box>
              </Box>
              
              <Box sx={{ 
                p: 1.5, 
                backgroundColor: 'white',
                borderBottom: '1px solid #e2e8f0',
                display: 'flex',
                justifyContent: 'center'
              }}>
                <ButtonGroup size="small">
                  <Button 
                    variant={previewMode === 'mobile' ? 'contained' : 'outlined'}
                    startIcon={<span className="material-icons">smartphone</span>}
                    onClick={() => setPreviewMode('mobile')}
                  >
                    モバイル
                  </Button>
                  <Button 
                    variant={previewMode === 'desktop' ? 'contained' : 'outlined'}
                    startIcon={<span className="material-icons">desktop_windows</span>}
                    onClick={() => setPreviewMode('desktop')}
                  >
                    デスクトップ
                  </Button>
                </ButtonGroup>
              </Box>
              
              <Box sx={{ flex: 1, p: 2, overflow: 'hidden' }}>
                <Paper 
                  sx={{ 
                    height: '100%', 
                    borderRadius: 2,
                    overflow: 'hidden',
                    ...previewMode === 'mobile' ? { 
                      maxWidth: 375, 
                      mx: 'auto'
                    } : {}
                  }}
                  elevation={3}
                >
                  <PreviewComponent 
                    html={activeVariant === 'A' ? mockPreviewHTML : mockPreviewHTMLVariantB} 
                    title={mockComponentStructure.find(c => c.id === selectedComponent)?.name || 'ランディングページ'} 
                    variant={activeVariant}
                  />
                </Paper>
              </Box>
            </Box>
          </Box>
          
          {/* プロンプトテンプレートダイアログ */}
          <Dialog 
            open={templateDialogOpen} 
            onClose={() => setTemplateDialogOpen(false)}
            maxWidth="sm"
            fullWidth
          >
            <DialogTitle>プロンプトテンプレート</DialogTitle>
            <DialogContent dividers>
              <Typography variant="body2" color="textSecondary" paragraph>
                以下のテンプレートから選択して、指示を効率的に作成できます。
              </Typography>
              <List>
                {mockPromptTemplates.map((template) => (
                  <ListItem 
                    key={template.id} 
                    button
                    onClick={() => handleTemplateSelect(template)}
                    sx={{ 
                      borderRadius: 2,
                      mb: 1,
                      '&:hover': {
                        backgroundColor: 'rgba(66, 153, 225, 0.08)'
                      }
                    }}
                  >
                    <ListItemIcon>
                      <span className="material-icons">description</span>
                    </ListItemIcon>
                    <ListItemText 
                      primary={template.name}
                      secondary={template.template.substring(0, 60) + '...'}
                    />
                  </ListItem>
                ))}
              </List>
            </DialogContent>
            <DialogActions>
              <Button onClick={() => setTemplateDialogOpen(false)}>キャンセル</Button>
            </DialogActions>
          </Dialog>
        </ThemeProvider>
      );
    };
    
    // アプリケーションのメインコンポーネント
    const App = () => {
      return (
        <ErrorBoundary>
          <LPEditor />
        </ErrorBoundary>
      );
    };
    
    // メインレンダリング
    try {
      const root = ReactDOM.createRoot(document.getElementById('root'));
      root.render(<App />);
      console.log('アプリケーションが正常にレンダリングされました');
    } catch (error) {
      console.error('レンダリングエラー:', error);
      document.getElementById('root').innerHTML = `
        <div style="padding: 20px; color: red; font-family: sans-serif;">
          <h2>アプリケーションのレンダリングに失敗しました</h2>
          <p>${error.message || 'エラーが発生しました'}</p>
          <button onclick="location.reload()">ページを再読み込み</button>
        </div>
      `;
    }
  </script>
</body>
</html>